<%- include('partials/header') -%>
<nav class="navbar navbar-expand-md navbar-light">
  <div class="container-xxl">
    <a class="navbar-brand p-2">  
      <span class="fw-bold text-secondary">
          Climb On - Session Tracker App
      </span>
    </a>
    <!--toggle button for nav-->
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#main-nav" aria-controls="main-nav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button> 
    <!--navbar links--> 
    <div class="collapse navbar-collapse justify-content-end align-center" id="main-nav">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="/session">New Session</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/profile">My Profile</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/logout">Logout</a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<h2 class="text-center text-secondary">Feed</h2>
<div class="container-lg">
  <ul class="p-0">
    <% for(var i=0; i<sessions.length; i++) {%>
      <li class="text-start row list-unstyled m-3 p-3 shadow rounded">
        <a class="btn btn-outline-primary btn-sm col-3 m-2" href="/post/viewSession/<%= sessions[i]._id %>" method="GET">Session Info</a>
        <p>Climber: <%= sessions[i].username %></p>
        <p>Session Date: <%= sessions[i].createdAt.toLocaleString('en-US', { timeZone: 'UTC', month: 'short', day: 'numeric', year: 'numeric' }) %></p>
        <p>Total Climbs This Session: <%= sessions[i].climbs.length %></p>
        <!-- Declares variable that holds hardest climb, iterates through each climbs to check if it was topped out-->
        <!-- Then checks what discipline of climbing and if it's harder than the currest hardest climb-->
        <% let hardestBoulder, hardestRoute %>
        <% for (var j = 0; j < sessions[i].climbs.length; j++) { %>
          <% const climb = sessions[i].climbs[j] %>
          <% if (climb.top === 'Yes') { %>
            <% if (climb.typeOfClimb === 'Bouldering' && (!hardestBoulder || climb.difficulty > hardestBoulder.difficulty)) { %>
              <% hardestBoulder = climb %>
            <% } else if (climb.typeOfClimb === 'Routes' && (!hardestRoute || climb.difficulty > hardestRoute.difficulty)) { %>
              <% hardestRoute = climb %>
            <% } %>
          <% } %>
        <% } %>
        <!-- Checking to see if either variable is truthy, will display difficulty of hardest climb in that category-->
        <% if (hardestBoulder) { %>
          <p>Hardest Boulder: <%= hardestBoulder.difficulty %></p>
        <% } %>
        <% if (hardestRoute) { %>
          <p>Hardest Route: <%= hardestRoute.difficulty %></p>
        <% } %>
        <p>Likes: <%= sessions[i].likes %></p>
        <% for (var j = 0; j < sessions[i].climbs.length; j++) { %>
          <% const climb = sessions[i].climbs[j] %>
          <% if (climb.image) { %>
            <span>Boulder Problems and Routes Pics:</span>
            <img class="p-2" style="width: 50%" src="<%= climb.image %>">
          <% } %>
        <% } %>

        <div class="btn-group">
          <% if (sessions[i].user == user.id) { %>
            <form action="/post/deleteSession/<%= sessions[i]._id %>?_method=DELETE" method="POST">
              <button class="btn btn-primary fa fa-trash me-2" type="submit"></button>
            </form>
          <% } %>
          <form action="/post/likePost/<%= sessions[i]._id %>?_method=PUT" method="POST">
            <button class="btn btn-primary fa fa-heart" type="submit"></button>
          </form>
        </div>
        <div>
          <p style="text-decoration: underline">Add A Comment</p>
            <form action="/post/commentSession/<%= sessions[i]._id %>" method="POST">
              <div class="btn-group">
                <input type="text" class="form-control" id="title" name="comment">
                <button type="submit" class="btn btn-primary" value="Comment">Submit</button>
              </div>
            </form>

          <ul class="row list-unstyled">
            <p style="text-decoration: underline">Comments</p>
              <% for (let j = 0; j < comments.length; j++) { %>
                <% const comment = comments[j] %>
                <% if (comment.sessionId.toString() === sessions[i]._id.toString()) { %>
                  <li>
                    <small><%= comment.comment %></small>
                    <small>Submitted by <%= comment.username %></small>
                  </li>
                <% } %>
              <% } %>
          </ul>             
        </div>
      </li>
    <% } %>
  </ul>
</div>  
<%- include('partials/footer') -%>
